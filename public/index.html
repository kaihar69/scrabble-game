<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Scrabble Chef Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Roboto:wght@500;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #eaddcf; 
            --bg-pattern: #dccaba;
            --board-border: #4e342e; --grid-gap: #111; --field-green: #2e7d32; 
            --tile-color: #f3e5ab; --tile-text: #2c3e50;
            --ui-dark: #2c3e50; --ui-gold: #d4af37; 
            --wood-dark: #5d4037; --wood-light: #8d6e63;
            --header-h: 80px; --footer-h: 140px;
        }

        * { box-sizing: border-box; }

        body { 
            font-family: 'Roboto', sans-serif; 
            background-color: var(--bg-color);
            background-image: radial-gradient(var(--bg-pattern) 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--ui-dark); margin: 0; padding: 0;
            height: 100dvh; width: 100vw; overflow: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* --- LOGIN --- */
        #login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);
            z-index: 1000; display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        #login-box {
            background: var(--bg-color); padding: 30px; border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5); text-align: center; border: 4px solid var(--ui-gold);
            width: 90%; max-width: 400px; display: flex; flex-direction: column; gap: 15px;
        }
        #login-box h2 { font-family: 'Cinzel', serif; margin: 0 0 10px 0; color: var(--wood-dark); }
        .inp { padding: 12px; font-size: 1.1rem; border: 2px solid var(--wood-light); border-radius: 5px; text-align: center; font-weight: bold; }
        
        .login-buttons { display: flex; gap: 10px; }
        #btn-start { flex: 2; padding: 15px; background: linear-gradient(to bottom, #27ae60, #219150); color: white; border: none; border-radius: 5px; cursor: pointer; text-transform: uppercase; font-weight: bold;}
        #btn-training { flex: 1; padding: 15px; background: linear-gradient(to bottom, #2980b9, #2471a3); color: white; border: none; border-radius: 5px; cursor: pointer; text-transform: uppercase; font-weight: bold;}

        /* --- SCOREBOARD --- */
        #scoreboard {
            height: var(--header-h); width: 98%; max-width: 700px;
            display: flex; justify-content: center; align-items: flex-end; 
            gap: 15px;
            background: linear-gradient(to bottom, #34495e, #2c3e50);
            border-bottom: 3px solid var(--ui-gold); border-radius: 0 0 15px 15px; padding: 0 10px 10px 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); color: #ecf0f1; flex-shrink: 0; position: relative; z-index: 50; 
        }
        
        #room-display {
            position: absolute; top: 5px; left: 50%; transform: translateX(-50%);
            font-family: 'Cinzel', serif; font-size: 0.8rem; color: var(--ui-gold);
            letter-spacing: 2px; opacity: 0.8; pointer-events: none;
        }

        .player-badge { display: flex; flex-direction: column; align-items: center; opacity: 0.5; transition: all 0.3s; width: 22%; }
        .player-badge.active-turn { opacity: 1; color: var(--ui-gold); text-shadow: 0 0 10px rgba(212, 175, 55, 0.5); transform: scale(1.05); font-weight: bold; }
        .p-name { font-size: 0.6rem; text-transform: uppercase; max-width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .p-score { font-size: 1.2em; font-weight: 900; font-family: 'Cinzel', serif;}
        
        #btn-add-bot { position: absolute; right: 10px; bottom: 15px; padding: 2px 6px; font-size: 0.6rem; background: #34495e; color: #7f8c8d; border: 1px solid #555; border-radius: 4px; cursor: pointer; display: none; }
        #btn-rules { position: absolute; left: 10px; top: 10px; width: 24px; height: 24px; background: rgba(255,255,255,0.1); color: #ccc; border: 1px solid #777; border-radius: 50%; cursor: pointer; font-size: 14px; font-weight: bold; font-family: 'Cinzel', serif; display: flex; align-items: center; justify-content: center; }

        /* --- BOARD --- */
        #board-wrapper { flex-grow: 1; width: 100%; display: flex; justify-content: center; align-items: center; overflow: hidden; padding: 5px; margin-top: 20px; }
        #game-board { 
            display: grid; grid-template-columns: repeat(15, 1fr); grid-template-rows: repeat(15, 1fr);
            gap: 2px; background: var(--grid-gap); border: 5px solid var(--board-border); border-radius: 4px;
            width: min(96vw, calc(100dvh - 240px)); height: min(96vw, calc(100dvh - 240px));
            aspect-ratio: 1 / 1; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .cell { 
            background: var(--field-green); 
            display: flex; align-items: center; justify-content: center; 
            position: relative; cursor: pointer; user-select: none; 
            aspect-ratio: 1 / 1; 
            overflow: hidden;
        }
        .cell-label { font-size: clamp(6px, 1.5vh, 10px); font-weight: bold; opacity: 0.7; pointer-events: none; }
        .tw { background-color: #b71c1c; .cell-label { color: #fff; } } .dw { background-color: #f57f17; .cell-label { color: #fff; } } 
        .tl { background-color: #0d47a1; .cell-label { color: #fff; } } .dl { background-color: #0288d1; .cell-label { color: #fff; } } 
        .center { background-color: #f57f17; } .star { font-size: 1.5em; color: #fff; padding-bottom: 5px; line-height: 1; }
        
        .tile-look {
            background: linear-gradient(135deg, #fffdf0 0%, #f3e5ab 100%); color: var(--tile-text);
            width: 92%; height: 92%; border-radius: 10%;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.4);
            display: flex; justify-content: center; align-items: center; position: relative; z-index: 10;
        }
        /* NEU: Letzter Zug Highlight */
        .tile-look.last-move {
            border: 2px solid #2980b9; 
            box-shadow: 0 0 8px #3498db, inset 0 0 5px #3498db;
        }

        .tile-letter { font-size: 65%; font-weight: 900; }
        .tile-score { position: absolute; bottom: 8%; right: 10%; font-size: 30%; font-weight: 600; color: #444; }
        .preview .tile-look { opacity: 0.7; box-shadow: none; border: 2px dotted #333; background: #fff; }
        .tile-look.joker .tile-score { display: none; } .tile-look.joker { border: 1px solid #d4af37; }

        /* --- UI CONTAINER --- */
        #ui-container { height: var(--footer-h); width: 100%; max-width: 600px; display: flex; flex-direction: column; gap: 8px; padding: 0 10px 10px 10px; justify-content: flex-end; flex-shrink: 0; }
        #rack { 
            background: linear-gradient(to bottom, var(--wood-dark), var(--wood-light)); padding: 6px 10px 4px 10px;
            border-radius: 8px; display: flex; justify-content: center; gap: 4px; height: 55px; 
            box-shadow: inset 0 3px 6px rgba(0,0,0,0.6); position: relative; opacity: 1 !important; 
        }
        .hand-slot { height: 90%; aspect-ratio: 1/1; display: flex; align-items: flex-end; justify-content: center; cursor: pointer; transition: transform 0.2s; z-index: 2; }
        .hand-slot.selected { transform: translateY(-15px); }
        .hand-slot.swap-selected .tile-look { border: 2px solid #e74c3c; box-shadow: 0 0 10px #e74c3c; }

        #controls { display: grid; grid-template-columns: 1fr 1fr 1fr 1.5fr; gap: 8px; height: 45px; }
        button { font-size: 0.8rem; border: none; border-radius: 8px; font-weight: bold; text-transform: uppercase; cursor: pointer; color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.3); box-shadow: 0 3px 0 rgba(0,0,0,0.2); transition: all 0.2s; }
        button:active { transform: translateY(2px); box-shadow: none; }
        button:disabled { background: #95a5a6; cursor: not-allowed; opacity: 0.5; box-shadow: none; transform: none; }
        .btn-pass { background: #7f8c8d; } .btn-swap { background: #3498db; } .btn-reset { background: #e74c3c; } .btn-submit { background: #27ae60; }
        body.swapping .btn-swap { background: #e67e22; animation: pulse 1s infinite; }
        body.swapping .btn-submit { content: 'Tausch bestätigen'; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }

        #msg-overlay { position: fixed; top: 120px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 10px 20px; border-radius: 20px; font-weight: bold; pointer-events: none; opacity: 0; transition: opacity 0.5s; z-index: 99; }

        /* OVERLAYS */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(3px); z-index: 2000; display: none; justify-content: center; align-items: center; }
        .overlay-box { background: var(--bg-color); padding: 25px; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.7); border: 3px solid var(--ui-gold); width: 90%; max-width: 500px; color: var(--ui-dark); position: relative; max-height: 90vh; overflow-y: auto; }
        .overlay-box h2 { font-family: 'Cinzel', serif; margin-top: 0; border-bottom: 2px solid var(--wood-light); }
        .close-btn { position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--wood-dark); box-shadow: none; }

        /* Joker Picker */
        #joker-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 5px; margin-top: 15px; }
        .joker-btn { background: var(--ui-dark); color: white; padding: 10px; font-weight: bold; border-radius: 4px; box-shadow: none; }
        .joker-btn:hover { background: var(--ui-gold); color: var(--ui-dark); }

        /* Game Over Styles */
        #game-over-box { text-align: center; border-color: #27ae60; background: #fffdf0; }
        .winner-cup { font-size: 3rem; color: #f1c40f; margin-bottom: 10px; animation: bounce 1s infinite; }
        .ranking-list { list-style: none; padding: 0; text-align: left; }
        .ranking-item { padding: 8px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; font-size: 1.1rem; }
        .ranking-item:first-child { font-weight: bold; color: #27ae60; font-size: 1.3rem; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    </style>
</head>
<body>

    <div id="rules-overlay" class="overlay">
        <div class="overlay-box" id="rules-box">
            <button class="close-btn" onclick="toggleRules()">×</button>
            <h2>Spielregeln</h2>
            <p>Joker (★) können jeden Buchstaben annehmen, bringen aber 0 Punkte.</p>
            <ul>
                <li><strong>Start:</strong> Mitte (Stern).</li>
                <li><strong>Joker:</strong> Wähle den Buchstaben beim Legen.</li>
                <li><strong>Umlaute:</strong> Ä, Ö, Ü erlaubt. ß als SS.</li>
                <li><strong>Ende:</strong> Wenn der Beutel leer ist und ein Spieler keine Steine mehr hat.</li>
            </ul>
        </div>
    </div>

    <div id="joker-overlay" class="overlay">
        <div class="overlay-box" style="text-align: center;">
            <h2>Joker wählen</h2>
            <p>Welchen Buchstaben soll der Joker ersetzen?</p>
            <div id="joker-grid"></div>
        </div>
    </div>
